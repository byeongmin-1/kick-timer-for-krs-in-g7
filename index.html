<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Offline Persistent Timer App</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; }
  table { border-collapse: collapse; width: 100%; margin-top: 10px; }
  th, td { border: 1px solid #000; padding: 8px; text-align: center; }
  th { background-color: #f2f2f2; }
  input { margin: 5px; }
  h3 { margin-top: 30px; }
</style>
</head>
<body>

<h2>Timer List</h2>

<div>
  <input type="text" id="nameInput" placeholder="Name">
  <input type="number" id="hoursInput" placeholder="Hours" min="0" max="87600"> 
  <input type="number" id="minutesInput" placeholder="Minutes" min="0" max="59">
  <input type="number" id="secondsInput" placeholder="Seconds" min="0" max="59">
  <button onclick="addTimer()">Start Timer</button>
</div>

<h3>Active Timers</h3>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Time Left</th>
    </tr>
  </thead>
  <tbody id="activeTimersBody"></tbody>
</table>

<h3>Finished Timers</h3>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Finished At</th>
    </tr>
  </thead>
  <tbody id="finishedTimersBody"></tbody>
</table>

<h3>Started Timers (History)</h3>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Time Started</th>
    </tr>
  </thead>
  <tbody id="historyBody"></tbody>
</table>

<script>
let activeTimers = [];
let finishedTimers = [];
let historyTimers = [];

// ---- LocalStorage Handling ----
function saveData() {
  localStorage.setItem("activeTimers", JSON.stringify(activeTimers));
  localStorage.setItem("finishedTimers", JSON.stringify(finishedTimers));
  localStorage.setItem("historyTimers", JSON.stringify(historyTimers));
}

function loadData() {
  activeTimers = JSON.parse(localStorage.getItem("activeTimers")) || [];
  finishedTimers = JSON.parse(localStorage.getItem("finishedTimers")) || [];
  historyTimers = JSON.parse(localStorage.getItem("historyTimers")) || [];

  updateActiveTable();
  updateFinishedTable();
  updateHistoryTable();
}

// ---- Timer Functions ----
function addTimer() {
  const name = document.getElementById("nameInput").value.trim();
  const hours = parseInt(document.getElementById("hoursInput").value) || 0;
  const minutes = parseInt(document.getElementById("minutesInput").value) || 0;
  const seconds = parseInt(document.getElementById("secondsInput").value) || 0;

  if (!name) {
    alert("Please enter a name.");
    return;
  }

  const maxHours = 10 * 365 * 24;
  if (hours > maxHours) {
    alert("Maximum timer is 10 years.");
    return;
  }

  const totalSeconds = hours * 3600 + minutes * 60 + seconds;
  const startTime = Date.now();
  const endTime = startTime + totalSeconds * 1000;

  activeTimers.push({ name, endTime });
  historyTimers.push({ name, startedAt: startTime });

  updateActiveTable();
  updateHistoryTable();
  saveData();

  // clear inputs
  document.getElementById("nameInput").value = "";
  document.getElementById("hoursInput").value = "";
  document.getElementById("minutesInput").value = "";
  document.getElementById("secondsInput").value = "";
}

function updateActiveTable() {
  const tbody = document.getElementById("activeTimersBody");
  tbody.innerHTML = "";

  activeTimers.forEach(timer => {
    const timeLeft = Math.max(0, Math.floor((timer.endTime - Date.now()) / 1000));
    const tr = document.createElement("tr");
    const tdName = document.createElement("td");
    tdName.textContent = timer.name;
    const tdTime = document.createElement("td");
    tdTime.textContent = formatTime(timeLeft);
    tr.appendChild(tdName);
    tr.appendChild(tdTime);
    tbody.appendChild(tr);
  });
}

function updateFinishedTable() {
  const tbody = document.getElementById("finishedTimersBody");
  tbody.innerHTML = "";

  finishedTimers.forEach(timer => {
    const tr = document.createElement("tr");
    const tdName = document.createElement("td");
    tdName.textContent = timer.name;
    const tdTime = document.createElement("td");
    tdTime.textContent = new Date(timer.finishedAt).toLocaleString();
    tr.appendChild(tdName);
    tr.appendChild(tdTime);
    tbody.appendChild(tr);
  });
}

function updateHistoryTable() {
  const tbody = document.getElementById("historyBody");
  tbody.innerHTML = "";

  historyTimers.forEach(timer => {
    const tr = document.createElement("tr");
    const tdName = document.createElement("td");
    tdName.textContent = timer.name;
    const tdTime = document.createElement("td");
    tdTime.textContent = new Date(timer.startedAt).toLocaleString();
    tr.appendChild(tdName);
    tr.appendChild(tdTime);
    tbody.appendChild(tr);
  });
}

function formatTime(seconds) {
  const h = Math.floor(seconds / 3600);
  const m = Math.floor((seconds % 3600) / 60);
  const s = seconds % 60;
  return `${h}h ${m}m ${s}s`;
}

// ---- Countdown ----
setInterval(() => {
  const now = Date.now();
  activeTimers = activeTimers.filter(timer => {
    const timeLeft = Math.floor((timer.endTime - now) / 1000);
    if (timeLeft <= 0) {
      finishedTimers.push({ name: timer.name, finishedAt: now });
      return false; // remove from active
    }
    return true;
  });

  updateActiveTable();
  updateFinishedTable();
  saveData();
}, 1000);

// Load saved data when page opens
loadData();
</script>

</body>
</html>
