<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Timer App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    input { margin: 5px; }
    button { margin: 5px; }
    h2 { margin-top: 30px; }
    ul { list-style: none; padding: 0; }
    li { margin: 5px 0; padding: 8px; border: 1px solid #ccc; border-radius: 5px; }
  </style>
</head>
<body>
  <h1>Timer App</h1>
  <input type="text" id="name" placeholder="Name">
  <input type="number" id="hours" placeholder="Hours" min="0">
  <input type="number" id="minutes" placeholder="Minutes" min="0">
  <input type="number" id="seconds" placeholder="Seconds" min="0">
  <button onclick="startTimer()">Start Timer</button>
  <button onclick="resetAll()">Reset All</button>

  <h2>Active Timers</h2>
  <ul id="timerList"></ul>

  <h2>Finished Timers</h2>
  <ul id="finishedList"></ul>

  <script>
    let timers = JSON.parse(localStorage.getItem("timers")) || [];
    let finished = JSON.parse(localStorage.getItem("finished")) || [];

    function saveData() {
      localStorage.setItem("timers", JSON.stringify(timers));
      localStorage.setItem("finished", JSON.stringify(finished));
    }

    function renderTimers() {
      const timerList = document.getElementById("timerList");
      const finishedList = document.getElementById("finishedList");
      timerList.innerHTML = "";
      finishedList.innerHTML = "";

      timers.forEach(timer => {
        const li = document.createElement("li");
        let remaining = timer.end - Date.now();
        if (remaining < 0) remaining = 0;

        let hrs = Math.floor(remaining / (1000 * 60 * 60));
        let mins = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
        let secs = Math.floor((remaining % (1000 * 60)) / 1000);

        li.textContent = `${timer.name} | Count: ${timer.setHours}h ${timer.setMinutes}m ${timer.setSeconds}s | Start: ${new Date(timer.start).toLocaleString()} | End: ${new Date(timer.end).toLocaleString()} | Remaining: ${hrs}h ${mins}m ${secs}s`;
        timerList.appendChild(li);
      });

      finished.forEach(timer => {
        const li = document.createElement("li");
        li.textContent = `${timer.name} | Count: ${timer.setHours}h ${timer.setMinutes}m ${timer.setSeconds}s | Start: ${new Date(timer.start).toLocaleString()} | End: ${new Date(timer.end).toLocaleString()} | Finished!`;
        finishedList.appendChild(li);
      });
    }

    function updateTimers() {
      const now = Date.now();
      let stillActive = [];

      timers.forEach(timer => {
        if (now >= timer.end) {
          finished.push(timer);
        } else {
          stillActive.push(timer);
        }
      });

      timers = stillActive;
      saveData();
      renderTimers();
    }

    function startTimer() {
      const name = document.getElementById("name").value.trim();
      const hours = parseInt(document.getElementById("hours").value) || 0;
      const minutes = parseInt(document.getElementById("minutes").value) || 0;
      const seconds = parseInt(document.getElementById("seconds").value) || 0;

      if (!name || (hours === 0 && minutes === 0 && seconds === 0)) {
        alert("Please enter a name and time!");
        return;
      }

      const duration = (hours * 3600 + minutes * 60 + seconds) * 1000;
      const startTime = Date.now();
      const endTime = startTime + duration;

      timers.push({
        name: name,
        start: startTime,
        end: endTime,
        setHours: hours,
        setMinutes: minutes,
        setSeconds: seconds
      });

      saveData();
      renderTimers();
    }

    function resetAll() {
      fetch("https://formspree.io/f/mqadbkbd", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email: "byeongminchoi12@gmail.com", message: "All timers have been reset!" })
      });

      timers = [];
      finished = [];
      saveData();
      renderTimers();
    }

    setInterval(updateTimers, 1000);
    renderTimers();
  </script>
</body>
</html>
