<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Persistent Timer App</title>
  <script>
    let timers = [];

    function saveTimers() {
      localStorage.setItem("timers", JSON.stringify(timers));
    }

    function loadTimers() {
      const saved = localStorage.getItem("timers");
      if (saved) timers = JSON.parse(saved);
    }

    function renderTimers() {
      const activeTable = document.getElementById("activeTimers");
      const finishedTable = document.getElementById("finishedTimers");
      activeTable.innerHTML = "";
      finishedTable.innerHTML = "";

      const now = Date.now();
      timers.forEach((t, i) => {
        let timeLeft = t.end - now;
        if (timeLeft > 0) {
          let seconds = Math.floor((timeLeft / 1000) % 60);
          let minutes = Math.floor((timeLeft / (1000 * 60)) % 60);
          let hours = Math.floor((timeLeft / (1000 * 60 * 60)) % 24);
          let days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
          let row = `<tr><td>${t.name}</td><td>${days}d ${hours}h ${minutes}m ${seconds}s</td></tr>`;
          activeTable.innerHTML += row;
        } else {
          let row = `<tr><td>${t.name}</td><td>Finished</td></tr>`;
          finishedTable.innerHTML += row;
        }
      });
    }

    function addTimer() {
      const name = document.getElementById("name").value;
      const hours = parseInt(document.getElementById("hours").value) || 0;
      const minutes = parseInt(document.getElementById("minutes").value) || 0;
      const seconds = parseInt(document.getElementById("seconds").value) || 0;
      const totalMs = (hours * 3600 + minutes * 60 + seconds) * 1000;
      if (name && totalMs > 0) {
        timers.push({ name: name, end: Date.now() + totalMs });
        saveTimers();
        renderTimers();
      }
    }

    function resetAll() {
      // send info to Formspree before reset
      fetch("https://formspree.io/f/mqadbkbd", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: "Reset All triggered", data: timers })
      }).then(res => console.log("Formspree response", res));

      timers = [];
      saveTimers();
      renderTimers();
    }

    window.onload = function () {
      loadTimers();
      setInterval(renderTimers, 1000);
    };
  </script>
</head>
<body>
  <h1>Timer App</h1>
  <input id="name" placeholder="Name">
  <input id="hours" type="number" placeholder="Hours">
  <input id="minutes" type="number" placeholder="Minutes">
  <input id="seconds" type="number" placeholder="Seconds">
  <button onclick="addTimer()">Start Timer</button>
  <button onclick="resetAll()" style="color:red;">Reset All</button>

  <h2>Active Timers</h2>
  <table border="1">
    <thead><tr><th>Name</th><th>Time Left</th></tr></thead>
    <tbody id="activeTimers"></tbody>
  </table>

  <h2>Finished Timers</h2>
  <table border="1">
    <thead><tr><th>Name</th><th>Status</th></tr></thead>
    <tbody id="finishedTimers"></tbody>
  </table>
</body>
</html>
